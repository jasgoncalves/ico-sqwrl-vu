<br>
<div class="container-fluid">
    <h1 class="display-6">Query The Ontology</h1>
    <br>
    <div class="input-group mb-3">
        <select class="custom-select" id="inputGroupSelect04" aria-label="Example select with button addon">
            <option value="0" selected>Select a predefined query ...</option>
            <option value="1">What are the metaheuristics published after 2015 ?</option>
            <option value="2">What are the Python libraries implementing NSGA-III ?</option>
            <option value="3">What are the metaheuristics that were tested in Knapsack problem ?</option>
            <option value="4">What are the metaheuristics that were tested in Knapsack problem having Java libraries implementations ?</option>
            <option value="5">Which order relations have been proposed to many-objective optimisation ?</option>
            <option value="6">Who are the researchers working both in decomposition-based and indicator-based metaheuristics ?</option>
        </select>
        <div *ngIf='!queryRunning' class="input-group-append">
            <button class="btn btn-outline-secondary" type="button" (click) = "runQuery()">Run Query</button>
        </div>
        <div *ngIf='queryRunning' class="input-group-append">
            <button class="btn btn-outline-secondary" type="button" disabled>
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                Running...
            </button>
        </div>
    </div>
    <br>
    <p class="text-center">Select a predefined query or Create your own customised query. Then, 'Run the query'.</p>
    <br>
    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Entity Type</th>
                <th scope="col">Entity</th>
                <th scope="col">Ordered By</th>
                <th scope="col">Show Column</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let query of queryArray; let i = index" [ngClass]="{'disabled': queryRunning}">
                <td>
                    <div class="input-group">
                        <select [(ngModel)]="query.entityType" class="form-select" name="{{query.entityType}}" (ngModelChange)="onEntityTypeChange($event)">
                            <option selected>{{query.entityType}}</option>
                            <option value="Class">Class</option>
                            <option value="DatatypeProperty">DatatypeProperty</option>
                            <option value="Individual">Individual</option>
                            <option value="ObjectProperty">ObjectProperty</option>
                            <option value="RelationalOperator">RelationalOperator</option>
                        </select>
                    </div>
                </td>
                <td>
                    <div class="input-group">
                        <select [(ngModel)]="query.id" class="form-select" name="{{query.id}}" (change)="onEntityChange(i, $event)">
                            <option selected>{{query.entity}}</option>
                            <option *ngFor="let entity of entityType" [ngValue]="entity.id">{{entity.label}}</option>
                        </select>
                    </div>
                </td>
                <td>
                    <div class="text-center">
                        <input [(ngModel)]="query.isOrderedBy" class="form-check-input" type="checkbox" name="{{query.isOrderedBy}}" />
                    </div>
                </td>
                <td>
                    <div class="text-center">
                        <input [(ngModel)]="query.isShowedInResult" class="form-check-input" type="checkbox" name="{{query.isShowedInResult}}" />
                    </div>
                </td>
                <td>
                    <div class="text-center">
                        <button class="btn btn-default"  type="button" (click)="deleteRow(i)">Delete</button>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="input-group">
                        <select id="newRowEntityType" [(ngModel)]="newRow.entityType" class="form-select" name="newRowEntityType" (ngModelChange)="onEntityTypeChange($event)">
                            <option selected>{{newRow.entityType}}</option>
                            <option value="Class">Class</option>
                            <option value="DatatypeProperty">DatatypeProperty</option>
                            <option value="Individual">Individual</option>
                            <option value="ObjectProperty">ObjectProperty</option>
                            <option value="RelationalOperator">RelationalOperator</option>
                        </select>
                    </div>
                </td>
                <td>
                    <div *ngIf='!loading' class="input-group">
                        <select [(ngModel)]="newRow.id" class="form-select" name="{{newRow.id}}" (change)="onNewRowEntityChange($event)" >
                            <option selected>{{newRow.entity}}</option>
                            <option *ngFor="let entity of entityType" [ngValue]="entity.id">{{entity.label}}</option>
                        </select>
                    </div>
                    <div  *ngIf='loading' class="d-flex justify-content-center">
                        <div class="spinner-grow" role="status"></div>
                    </div>
                </td>
                <td>
                    <div class="text-center">
                        <input class="form-check-input" type="checkbox" id="newRowIsOrderedBy" [(ngModel)]="newRow.isOrderedBy" name="newRowIsOrderedBy" />
                    </div>
                </td>
                <td>
                    <div class="text-center">
                        <input class="form-check-input" type="checkbox" id="newRowIsShowedInResult" [(ngModel)]="newRow.isShowedInResult" name="newRowIsShowedInResult" />
                    </div>
                </td>
                <td>
                    <div class="text-center">
                        <button class="btn btn-default" type="button" (click)="addRow()">Add</button>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    
    <br>
    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Row</th>
                <th *ngFor="let column of columns" scope="col">{{column}}</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let result of queryResult; index as i">
                <th scope="row">{{result["id"]}}</th>
                <td *ngFor="let column of columns">{{result[column]}}</td>
            </tr>
        </tbody>
    </table>
    <div class="d-flex justify-content-between p-2">
        <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [pageSize]="pageSize" (pageChange)="refreshResult()"></ngb-pagination>
        <select class="custom-select" style="width: auto" [(ngModel)]="pageSize" (ngModelChange)="refreshResult()">
            <option [ngValue]="10">10 items per page</option>
            <option [ngValue]="20">20 items per page</option>
            <option [ngValue]="50">50 items per page</option>
        </select>
    </div>
</div>